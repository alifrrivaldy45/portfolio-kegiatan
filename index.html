// ===== SISTEM PENYIMPANAN DATA DENGAN LOCALSTORAGE =====

// Fungsi untuk memuat data dari localStorage
function loadDataFromStorage() {
    // Muat kegiatan
    const storedActivities = localStorage.getItem('portfolioActivities');
    if (storedActivities) {
        activities = JSON.parse(storedActivities);
    }

    // Muat link
    const storedLinks = localStorage.getItem('portfolioLinks');
    if (storedLinks) {
        savedLinks = JSON.parse(storedLinks);
    }
}

// Fungsi untuk menyimpan kegiatan ke localStorage
function saveActivitiesToStorage() {
    localStorage.setItem('portfolioActivities', JSON.stringify(activities));
}

// Fungsi untuk menyimpan link ke localStorage
function saveLinksToStorage() {
    localStorage.setItem('portfolioLinks', JSON.stringify(savedLinks));
}

// ===== INISIALISASI & MODIFIKASI FUNGSI YANG ADA =====

// Data untuk link yang disimpan
let savedLinks = [];
// Data untuk kegiatan
let activities = [];

// Inisialisasi aplikasi
document.addEventListener('DOMContentLoaded', function() {
    // MUAT DATA DARI LOCALSTORAGE SAAT PERTAMA KALI
    loadDataFromStorage();

    // Set konten awal dan render data yang telah dimuat
    loadSection('dashboard');
    renderSavedLinks();
    
    // ... (kode setup event listeners lainnya TETAP SAMA)
    setupNavigation();
    document.getElementById('addActivityBtn').addEventListener('click', addNewActivity);
    document.getElementById('saveLinkBtn').addEventListener('click', saveLink);
    document.getElementById('exportBtn').addEventListener('click', exportData);
    document.getElementById('mobileToggle').addEventListener('click', toggleMobileMenu);
    
    document.getElementById('linkTitle').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') saveLink();
    });
    document.getElementById('linkInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') saveLink();
    });
});

// ===== MODIFIKASI FUNGSI AGAR MENYIMPAN KE LOCALSTORAGE =====

// Fungsi untuk menambah kegiatan baru (MODIFIED)
function addNewActivity() {
    const title = prompt("Masukkan judul kegiatan baru:");
    if (!title || title.trim() === "") return;
    
    const description = prompt("Masukkan deskripsi kegiatan:");
    const tagsInput = prompt("Masukkan tag (pisahkan dengan koma):");
    
    const newActivity = {
        id: activities.length > 0 ? Math.max(...activities.map(a => a.id)) + 1 : 1,
        section: getCurrentSection(),
        title: title,
        description: description || "Deskripsi kegiatan",
        tags: tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : ['Baru']
    };
    
    activities.push(newActivity);
    // SIMPAN KE LOCALSTORAGE SETELAH MENAMBAH
    saveActivitiesToStorage();
    renderActivities(getCurrentSection());
    
    // ... (kode update detail meta TETAP SAMA)
    alert(`Kegiatan "${title}" berhasil ditambahkan!`);
}

// Fungsi untuk menyimpan link (MODIFIED)
function saveLink() {
    const urlInput = document.getElementById('linkInput');
    const titleInput = document.getElementById('linkTitle');
    
    const url = urlInput.value.trim();
    const title = titleInput.value.trim();
    
    if (!url) {
        alert('Silakan masukkan URL link terlebih dahulu!');
        urlInput.focus();
        return;
    }
    
    try {
        new URL(url);
    } catch (e) {
        alert('URL tidak valid. Pastikan URL dimulai dengan http:// atau https://');
        urlInput.focus();
        return;
    }
    
    const newLink = {
        id: savedLinks.length > 0 ? Math.max(...savedLinks.map(l => l.id)) + 1 : 1,
        url: url,
        title: title || url
    };
    
    savedLinks.push(newLink);
    // SIMPAN KE LOCALSTORAGE SETELAH MENAMBAH
    saveLinksToStorage();
    renderSavedLinks();
    
    urlInput.value = '';
    titleInput.value = '';
    alert('Link berhasil disimpan!');
}

// Fungsi untuk menghapus link (MODIFIED)
function deleteLink(linkId) {
    if (confirm('Apakah Anda yakin ingin menghapus link ini?')) {
        savedLinks = savedLinks.filter(link => link.id !== linkId);
        // SIMPAN KE LOCALSTORAGE SETELAH MENGHAPUS
        saveLinksToStorage();
        renderSavedLinks();
    }
}

// Fungsi edit link (MODIFIED)
function editLink(linkId) {
    const link = savedLinks.find(l => l.id === linkId);
    if (!link) return;
    
    const newTitle = prompt("Edit judul link:", link.title);
    if (newTitle !== null) {
        link.title = newTitle || link.url;
        // SIMPAN KE LOCALSTORAGE SETELAH MENGEDIT
        saveLinksToStorage();
        renderSavedLinks();
    }
}

// ... (Fungsi-fungsi lainnya seperti renderSavedLinks, renderActivities, exportData, dll. TETAP SAMA. JANGAN DIHAPUS)
// Pastikan fungsi-fungsi tersebut masih ada di bagian akhir kode Anda.
